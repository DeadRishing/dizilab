(function($){    $.fn.pKisalt = function(ayarlar){        var ayar = $.extend({            'limit'	: 20,            'nokta' : true,            'goster' : true,            'gizle' : true,            'text'  : 'göster',            'text2' : 'gizle'        }, ayarlar);        return this.each(function(){            var diger = '';            var gizle = '';            var nesne = $(this);            var length = nesne.text().length;            if (length > ayar.limit){                nesne.wrap('<div class="pKisalt_kisaltilmis"></div>');                if (ayar.gizle == true){                    gizle = ' <a href="#" class="pKisalt_gizle">'+ayar.text2+'</a>';                }                nesne.after('<div class="pKisalt_orjinal" style="display: none">'+nesne.text() + gizle +'</div>');                if (ayar.nokta == true){                    diger = '..';                }                if  (ayar.goster == true){                    diger += ' <a href="#" class="pKisalt_goster">'+ayar.text+'</a>';                }                var text = nesne.text();                var kisaltilmis = text.substr(0, ayar.limit) + diger;                $(this).html(kisaltilmis);            }            $("a.pKisalt_goster").click(function(){                $(this).parent().hide().next(".pKisalt_orjinal").show();                return false            });            $("a.pKisalt_gizle").click(function(){                $(this).parent().hide().prev().show();                return false            });        });    }})(jQuery);function load_series(){    $.ajax({        url: mobile_url + "/diziler",        dataType: "xml",        success: function( xmlResponse ) {            var data = $( "dizi", xmlResponse ).map(function() {                return {                    adi: $( "adi", this ).text(),                    url: $( "url", this ).text(),                    resim: $( "resim", this).text(),                    tur: $( "tur", this).text()                };            }).get();            var search_content = $('.search-box .list ul');            for ( var i = 0; i < data.length; i++ ){                var dizi = data[i];                search_content.append('<li>\                        <a href="' + (dizi.url).replace('http://', 'http://m.') + '">\                            <img src="' + dizi.resim + '" alt="">\                            <span class="title">' + dizi.adi + '</span>\                            <span class="category">' + dizi.tur + '</span>\                        </a>\                    </li>');            }            $.expr[':'].icontains = function(obj, index, meta, stack){                return (obj.textContent || obj.innerText || jQuery(obj).text() || '').toLowerCase().indexOf(meta[3].toLowerCase()) >= 0;            };            var result_content = $('.search-box .list'),                result_items = $('.search-box .list ul li');            $('#searchbar').on('keyup', function(e){                result_content.show();                var val = $(this).val();                result_items.hide().removeClass('item').filter(':icontains(' + val + ')').show().addClass('item');                if ( result_items.filter(':visible').length == 0 ){                    $('.result-error').show();                } else {                    $('.result-error').hide();                }                if ( val == '' ){                    result_content.show();                }            });        }    });}load_series();$(function(){    $('[data-open]').on('click', function(e){        var target = $(this).data('open');        $(target).show();        $('body').css('overflow','hidden');        e.preventDefault();    });    $('[data-close]').on('click', function(e){        var target = $(this).data('close');        $(target).hide();        $('body').css('overflow','auto');        e.preventDefault();    });    /* spoiler comment */    $('.spoiler').each(function(){        $('>.c-text p', this).hide();    });    $(document.body).on('click', '.spoiler-text', function(e){        $(this).hide().next('p').show();        e.preventDefault();    });    $(document.body).on('click', '[data-seek]', function(e){        var time = $(this).data('seek');        goSeek(time);        e.preventDefault();    });    $('.series-text').pKisalt({        limit : 250,        text  : "(devamını göster)",        text2 : "(tekrar gizle)"    });    $('.tv-series-episodes:first').show();    $('select[name=episodes]').on('change', function(e){        $('.tv-series-episodes').hide().filter(':eq(' + ($(this).val() - 1) + ')').show();    });});function goSeek(time){    time = time.split(':');    var second = parseInt(time[0]) * 60;    second = parseInt(time[1]) + second;    delete localStorage['position_' + episode_id];    jwplayer().seek(second);    $('html, body').stop().animate({        'scrollTop': $('#player').offset().top - 65    }, 900, 'swing');};function comment_load(id){    if ( !$('.load-more').hasClass('wait') ){        $('.load-more').addClass('wait');        var comment_id = $('.comments .comment:last').data('id');        $.post(ajax_url, {'type': 'comment-load', 'chapter_id': id, 'comment_id': comment_id}, function(response){            if ( response.success ){                $('#comments').append( response.success );            }            if ( response.end ){                $('.load-more').remove();            }            $('.load-more').removeClass('wait');        }, 'json');    }}function watched_load(){    if ( !$('.load-more').hasClass('wait') ){        $('.load-more').addClass('wait');        var watch_id = $('.last-watched ul li:last').data('id');        $.post(ajax_url, {'type': 'watched-load', 'watch_id': watch_id}, function(response){            if ( response.success ){                $('.last-watched ul').append( response.success );            }            if ( response.end ){                $('.load-more').remove();            }            $('.load-more').removeClass('wait');        }, 'json');    }}function followed_load(){    if ( !$('.load-more').hasClass('wait') ){        $('.load-more').addClass('wait');        var follow_id = $('.last-watched ul li:last').data('id');        $.post(ajax_url, {'type': 'followed-load', 'follow_id': follow_id}, function(response){            if ( response.success ){                $('.last-watched ul').append( response.success );            }            if ( response.end ){                $('.load-more').remove();            }            $('.load-more').removeClass('wait');        }, 'json');    }}function login(){    $('.loader').show();    var username = $('input[name=username]').val(),        password = $('input[name=password]').val();    $.post( ajax_url, {'type':'login', 'username': username, 'password': password}, function(response){        if ( response.error ){            alert( response.error );            $('.loader').hide();        } else {            window.location.reload(true);        }    }, 'json');}function comment_like(id){    $.post(ajax_url, {'id':id,'type':'comment_like'}, function(response){        if ( response.error ){            alert(response.error);        } else {            $('#like_' + id).text( parseInt($('#like_' + id).text()) + 1 );        }    }, 'json');}function comment_dislike(id){    $.post(ajax_url, {'id':id,'type':'comment_dislike'}, function(response){        if ( response.error ){            alert(response.error);        } else {            $('#dislike_' + id).text( parseInt($('#dislike_' + id).text()) + 1 );        }    }, 'json');}function addcomment(){    var yorum = $('textarea[name=yorum_text]').val(),        spoiler = $('input[name=spoiler]:checked').val();    $('#addcomment').addClass('form-active');    $.post(ajax_url, {'yorum': yorum, 'spoiler': spoiler, 'type': 'addcomment'}, function(response){        $('#addcomment').removeClass('form-active');        if ( response.error ){            alert( response.error );        } else {            $('.no-comment').remove();            $('#comments').prepend( response.comment );            $('[name=yorum_text]').val('');        }    }, 'json');}function add_to_my_watch(id, elem){    $('.loader').show();    $.post( ajax_url, {'id':id, 'type':'add_to_my_watch'}, function(response){        if ( response.error ){            alert( response.error );        } else {            $(elem).toggleClass('active');        }        $('.loader').hide();    }, 'json');}function series_follow(id, elem){    $.post(ajax_url, {'id':id,'type':'series_follow'}, function(response){        if ( response.error ){            alert(response.error);        } else {            $(elem).attr('onclick', 'series_unfollow("' + id + '", this)').html('<span class="fa fa-check"></span> Aboneliği İptal Et');        }    }, 'json');}function series_unfollow(id, elem, type){    $.post(ajax_url, {'id':id,'type':'series_unfollow'}, function(response){        if ( response.error ){            alert(response.error);        } else {            if ( type ){                $(elem).closest('li').fadeTo(1000, .4, function(){                    $(this).remove();                });            } else {                $(elem).attr('onclick', 'series_follow("' + id + '", this)').html('<span class="fa fa-check"></span> Abone Ol');            }        }    }, 'json');}function series_like(id){    $.post(ajax_url, {'id':id,'type':'series_like'}, function(response){        if ( response.error ){            if ( response.login_open ){                $('.login').click();            } else {                alert(response.error);            }        } else {            $('#like_' + id).text( parseInt($('#like_' + id).text()) + 1 );        }    }, 'json');    return false;}function series_dislike(id){    $.post(ajax_url, {'id':id,'type':'series_dislike'}, function(response){        if ( response.error ){            alert(response.error);        } else {            $('#dislike_' + id).text( parseInt($('#dislike_' + id).text()) + 1 );        }    }, 'json');}function watched(id){    $.post(ajax_url, {'id': id, 'type': 'watched'}, function(response){        if ( response.success ){            $('#watched').fadeIn(300).html(response.success);            setTimeout(function(){                $('#watched').remove();            }, 6000);        }    }, 'json');}